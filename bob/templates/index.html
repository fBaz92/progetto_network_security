<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Messaging App - {{ name }}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const socket = io();

        socket.on("new_message", (data) => {
          const messagesDiv = document.getElementById("messages");
          const newMessage = document.createElement("div");
          newMessage.innerHTML = `
                    <div><span style="color: blue;">${
                      data.sender
                    }</span> to <span style="color: green;">${
            data.receiver
          }</span> at <span style="color: gray;">${
            data.recv_timestamp
          }</span></div>
                    <div>Send Time: ${data.send_timestamp}</div>
                    <div>Message: ${data.message}</div>
                    ${
                      data.ascii_values
                        ? `<div>ASCII Values: ${data.ascii_values}</div>`
                        : ""
                    }
                    ${
                      data.encrypted_message
                        ? `<div>Encrypted Message: ${data.encrypted_message}</div>`
                        : ""
                    }
                    ${
                      data.bin_message
                        ? `<div>Binary Message: ${data.bin_message}</div>`
                        : ""
                    }
                `;
          messagesDiv.appendChild(newMessage);
        });

        fetch("/hosts")
          .then((response) => response.json())
          .then((hosts) => {
            const hostSelect = document.getElementById("host");
            hostSelect.innerHTML = '<option value="">Select a host</option>'; // Clear existing options
            hosts.forEach((host) => {
              const option = document.createElement("option");
              option.value = host;
              option.textContent = host;
              hostSelect.appendChild(option);
            });
          });
      });
    </script>
  </head>
  <body>
    <h1>Messaging App - {{ name }}</h1>
    <form action="/send" method="post">
      <select name="host" id="host" required>
        <option value="">Select a host</option>
      </select>
      <input
        type="text"
        name="message"
        placeholder="Type your message here"
        required
      />
      <button type="submit">Send</button>
    </form>
    <div id="messages">
      {% for msg in messages %}
      <div>
        <div>
          <span style="color: blue">{{ msg.sender }}</span> to
          <span style="color: green">{{ msg.receiver }}</span> at
          <span style="color: gray">{{ msg.recv_timestamp }}</span>
        </div>
        <div>Send Time: {{ msg.send_timestamp }}</div>
        <div>{{ msg.type|capitalize }} Message: {{ msg.message }}</div>
        {% if msg.ascii_values %}
        <div>ASCII Values: {{ msg.ascii_values }}</div>
        {% endif %} {% if msg.encrypted_message %}
        <div>Encrypted Message: {{ msg.encrypted_message }}</div>
        {% endif %} {% if msg.bin_message %}
        <div>Binary Message: {{ msg.bin_message }}</div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </body>
</html>
